(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{334:function(a,s,e){"use strict";e.r(s);var t=e(4),n=Object(t.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"cmake常用命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cmake常用命令"}},[a._v("#")]),a._v(" CMake常用命令")]),a._v(" "),s("p",[a._v("作为学习时的记录，附加了简单的分析。")]),a._v(" "),s("h2",{attrs:{id:"构建makefile和编译、链接"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#构建makefile和编译、链接"}},[a._v("#")]),a._v(" 构建makefile和编译、链接")]),a._v(" "),s("p",[a._v("一般来说，采用外部构建策略，即拆分源码和build临时文件。方法很简单，就是在工程汇总增加build文件夹，在这里面进行构建makefile的操作。")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" proj_name/build\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("然后生成makefile")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("cmake ..\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("此时就生成了对应的makefile文件，再进行编译和链接，此时可以执行")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("make")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("或者使用cmake的语法")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("cmake "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-build")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("至此就生成了对应的二进制文件，然后执行即可。")]),a._v(" "),s("h2",{attrs:{id:"版本号与工程名"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#版本号与工程名"}},[a._v("#")]),a._v(" 版本号与工程名")]),a._v(" "),s("h3",{attrs:{id:"cmake版本号"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cmake版本号"}},[a._v("#")]),a._v(" CMake版本号")]),a._v(" "),s("div",{staticClass:"language-cmake line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-cmake"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("cmake_minimum_required")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token property"}},[a._v("VERSION")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3.10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("该命令指明了运行该cmake程序需要的最小版本号，")]),a._v(" "),s("h3",{attrs:{id:"工程及其版本号"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#工程及其版本号"}},[a._v("#")]),a._v(" 工程及其版本号")]),a._v(" "),s("div",{staticClass:"language-cmake line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-cmake"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("project")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("MyProject "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v("VERSION")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1.0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("这句话指明了：")]),a._v(" "),s("ul",[s("li",[a._v("工程的名称是MyProject")]),a._v(" "),s("li",[a._v("版本是1.0（可以省略）")])]),a._v(" "),s("h2",{attrs:{id:"设置c-版本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设置c-版本"}},[a._v("#")]),a._v(" 设置C++版本")]),a._v(" "),s("p",[a._v("即选择构建、编译链接等过程中遵循的C++标准究竟是C++ 11还是C++20或其他版本。")]),a._v(" "),s("div",{staticClass:"language-cmake line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-cmake"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("CMAKE_CXX_STANDARD")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("11")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("CMAKE_CXX_STANDARD_REQUIRED")]),a._v(" True"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h2",{attrs:{id:"定义变量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#定义变量"}},[a._v("#")]),a._v(" 定义变量")]),a._v(" "),s("p",[a._v("在上一小节中出现了关键字set，它的作用就是显示地定义一个变量，或者为变量赋值。")]),a._v(" "),s("p",[a._v("简化的语法是")]),a._v(" "),s("div",{staticClass:"language-cmake line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-cmake"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("VAR ["),s("span",{pre:!0,attrs:{class:"token property"}},[a._v("VALUE")]),a._v("]"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("后也即可以为定义VAR，并赋值为VALUE")]),a._v(" "),s("h2",{attrs:{id:"源文件与对应的可执行文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#源文件与对应的可执行文件"}},[a._v("#")]),a._v(" 源文件与对应的可执行文件")]),a._v(" "),s("p",[a._v("利用下面的命令")]),a._v(" "),s("div",{staticClass:"language-cmake line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-cmake"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("add_executable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("hello main.c func.c"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("这说明文件会生成一个名为hello的文件，它对应的源文件是main.c func.c等。")]),a._v(" "),s("p",[a._v("其中第一个是生成的文件名，后面则是源文件列表。")]),a._v(" "),s("h2",{attrs:{id:"指明有源文件的子目录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#指明有源文件的子目录"}},[a._v("#")]),a._v(" 指明有源文件的子目录")]),a._v(" "),s("p",[a._v("比如某些情况下，当工程比较大时，整个工程的结构需要如下所示：")]),a._v(" "),s("ul",[s("li",[a._v("MyProject\n"),s("ul",[s("li",[a._v("doc - 存放文档")]),a._v(" "),s("li",[a._v("src - 存放源码")]),a._v(" "),s("li",[a._v("build - 存放构建的临时文件\n"),s("ul",[s("li",[a._v("bin - 存放二进制文件")])])]),a._v(" "),s("li",[a._v("README")]),a._v(" "),s("li",[a._v("CMakeFiles.txt")])])])]),a._v(" "),s("p",[a._v("上述的操作可以用下面的方法实现：")]),a._v(" "),s("div",{staticClass:"language-cmake line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-cmake"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("add_subdirectory")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("src bin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("这句话的意思是，")]),a._v(" "),s("ul",[s("li",[a._v("src是一个子文件夹，它是存放源文件的文件夹。")]),a._v(" "),s("li",[a._v("bin表示由该文件夹中的二进制文件存放位置为./bin/，注意是此时的相对路径。（也可以写成绝对路径）")])]),a._v(" "),s("h2",{attrs:{id:"构建静态库与动态库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#构建静态库与动态库"}},[a._v("#")]),a._v(" 构建静态库与动态库")]),a._v(" "),s("p",[a._v("一般用cpp写的模块都不是直接执行，而是作为某个静态库或动态库来加载。要生成这个动态库和静态库（而不只是一个可执行的二进制文件）需要对应的命令：")]),a._v(" "),s("div",{staticClass:"language-cmake line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-cmake"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("add_library")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("hello "),s("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("SHARED")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("${")]),a._v("LIBHELLO_SRC"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("ul",[s("li",[a._v("生成的库名为hello")]),a._v(" "),s("li",[a._v("生成的库是动态（其中第二个变量可以是：SHARED、STATIC、MODULE）")]),a._v(" "),s("li",[a._v("LIBHELLO_SRC指明了生成库的路径")])]),a._v(" "),s("p",[a._v("为了生成静态库，则使用下面的命令：")]),a._v(" "),s("div",{staticClass:"language-cmake line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-cmake"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("add_library")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("hello "),s("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("STATIC")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("${")]),a._v("LIBHELLO_SRC"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("但是，一个问题是同时使用上述两个命令会失败一个，因为名字是相同的。一个比较简单的方法是使用不同的名字。")]),a._v(" "),s("h2",{attrs:{id:"添加共享库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#添加共享库"}},[a._v("#")]),a._v(" 添加共享库")]),a._v(" "),s("p",[a._v("添加非标准的文件搜索路径（告诉编译器，通常用于头文件）")]),a._v(" "),s("div",{staticClass:"language-cmake line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-cmake"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("include_directories")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("/usr/include/hello"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("添加非标准的共享库搜索路径（告诉链接器，用于共享库）")]),a._v(" "),s("div",{staticClass:"language-cmake line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-cmake"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("link_directories")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("directory1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("为执行目标link到共享库")]),a._v(" "),s("div",{staticClass:"language-cmake line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-cmake"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("target_link_libraries")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("target library1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])])])}),[],!1,null,null,null);s.default=n.exports}}]);